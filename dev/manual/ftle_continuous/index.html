<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field · ILMPostProcessing.jl</title><meta name="title" content="Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field · ILMPostProcessing.jl"/><meta property="og:title" content="Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field · ILMPostProcessing.jl"/><meta property="twitter:title" content="Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field · ILMPostProcessing.jl"/><meta name="description" content="Documentation for ILMPostProcessing.jl."/><meta property="og:description" content="Documentation for ILMPostProcessing.jl."/><meta property="twitter:description" content="Documentation for ILMPostProcessing.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ILMPostProcessing.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../pod/">Proper orthogonal decomposition (POD)</a></li><li><a class="tocitem" href="../dmdtest/">Dynamic mode decomposition (DMD)</a></li><li class="is-active"><a class="tocitem" href>Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field</a><ul class="internal"><li><a class="tocitem" href="#Example-1:-Unsteady-Double-Gyre"><span>Example 1: Unsteady Double Gyre</span></a></li><li><a class="tocitem" href="#Example-2-Issues-with-the-Sliding-Window-Approach"><span>Example 2 - Issues with the Sliding-Window Approach</span></a></li></ul></li><li><a class="tocitem" href="../ftle/">Finite-Time Lyapunov Exponent (FTLE)</a></li><li><a class="tocitem" href="../lavd/">Lagrangian-averaged vorticity deviation (LAVD)</a></li><li><a class="tocitem" href="../functions/">Functions and types</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ILMPostProcessing.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ILMPostProcessing.jl/blob/master/test/literate/ftle_continuous.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Finite-Time-Lyapunov-Exponent-(FTLE)-with-Continuous-Velocity-Field"><a class="docs-heading-anchor" href="#Finite-Time-Lyapunov-Exponent-(FTLE)-with-Continuous-Velocity-Field">Finite-Time Lyapunov Exponent (FTLE) with Continuous Velocity Field</a><a id="Finite-Time-Lyapunov-Exponent-(FTLE)-with-Continuous-Velocity-Field-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-Time-Lyapunov-Exponent-(FTLE)-with-Continuous-Velocity-Field" title="Permalink"></a></h1><p>We present two examples where the FTLE is calculated from known continuous velocity fields as opposed to discrete fields specified at grid points. The first example demonstrates a simple FTLE analysis and lays the conceptual foundation for later analysis on discrete data. The second example showcases an issue of sliding-window FTLE analysis.</p><pre><code class="language-julia hljs">using ILMPostProcessing
using ImmersedLayers
using Plots</code></pre><h2 id="Example-1:-Unsteady-Double-Gyre"><a class="docs-heading-anchor" href="#Example-1:-Unsteady-Double-Gyre">Example 1: Unsteady Double Gyre</a><a id="Example-1:-Unsteady-Double-Gyre-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Unsteady-Double-Gyre" title="Permalink"></a></h2><p>This example replicates the time-dependent double gyre from Shadden 2005. The double gyre velocity field&#39;s specification can be found at https://shaddenlab.berkeley.edu/uploads/LCS-tutorial/examples.html#Sec7.1. The results in this simulation is highly similar.</p><h3 id="Generate-Initial-Conditions-for-the-IVP"><a class="docs-heading-anchor" href="#Generate-Initial-Conditions-for-the-IVP">Generate Initial Conditions for the IVP</a><a id="Generate-Initial-Conditions-for-the-IVP-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-Initial-Conditions-for-the-IVP" title="Permalink"></a></h3><pre><code class="language-julia hljs">X_MIN, X_MAX = 0.0, 2.0
Y_MIN, Y_MAX = 0.0, 1.0
dx = 0.002

ftlegrid = PhysicalGrid((X_MIN,X_MAX),(Y_MIN,Y_MAX),dx);
ftle_cache = SurfaceScalarCache(ftlegrid)
x0, y0 = x_grid(ftle_cache), y_grid(ftle_cache)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(CartesianGrids.Primal nodes in a (nx = 1008, ny = 504) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 1007, ny = 503), CartesianGrids.Primal nodes in a (nx = 1008, ny = 504) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 1007, ny = 503))</code></pre><h3 id="Define-the-Double-Gyre&#39;s-Vector-Field"><a class="docs-heading-anchor" href="#Define-the-Double-Gyre&#39;s-Vector-Field">Define the Double Gyre&#39;s Vector Field</a><a id="Define-the-Double-Gyre&#39;s-Vector-Field-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-Double-Gyre&#39;s-Vector-Field" title="Permalink"></a></h3><pre><code class="language-julia hljs">A = 0.1
epsilon = 0.25
omega = 2 * π / 10

a(s) = epsilon * sin(omega * s)
b(s) = 1 - 2 * epsilon * sin(omega * s)
f(x, t) = a(t) * x^2 + b(t) * x
dfdx(x, t) = 2 * a(t) * x + b(t)

u(x,y,t) = -π * A * sin.(π * f(x, t)) .* cos.(π * y)
v(x,y,t) = π * A * cos.(π * f(x, t)) .* sin.(π * y) .* dfdx(x, t)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">v (generic function with 1 method)</code></pre><h3 id="Solve-the-Forward-and-Backward-IVPs"><a class="docs-heading-anchor" href="#Solve-the-Forward-and-Backward-IVPs">Solve the Forward and Backward IVPs</a><a id="Solve-the-Forward-and-Backward-IVPs-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-the-Forward-and-Backward-IVPs" title="Permalink"></a></h3><pre><code class="language-julia hljs">t0 = 0.0
T = 12
xf, yf = displacement_field(u,v,x0,y0,(t0,t0+T))
xb, yb = displacement_field(u,v,x0,y0,(t0,t0-T))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(CartesianGrids.Primal nodes in a (nx = 1008, ny = 504) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 1007, ny = 503), CartesianGrids.Primal nodes in a (nx = 1008, ny = 504) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 1007, ny = 503))</code></pre><h3 id="Compute-the-Forward-and-Backward-FTLEs"><a class="docs-heading-anchor" href="#Compute-the-Forward-and-Backward-FTLEs">Compute the Forward and Backward FTLEs</a><a id="Compute-the-Forward-and-Backward-FTLEs-1"></a><a class="docs-heading-anchor-permalink" href="#Compute-the-Forward-and-Backward-FTLEs" title="Permalink"></a></h3><pre><code class="language-julia hljs">fFTLE = similar(x0)
bFTLE = similar(x0)
compute_FTLE!(fFTLE,xf,yf,dx,dx,T)
compute_FTLE!(bFTLE,xb,yb,dx,dx,T)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1005×501 view(::CartesianGrids.Nodes{CartesianGrids.Primal, 1008, 504, Float64, Matrix{Float64}}, 2:1006, 2:502) with eltype Float64:
 0.502446   0.502446  0.502446  0.502446  …  0.216346   0.460102  0.517813
 0.53679    0.536791  0.536795  0.536801     0.187228   0.460086  0.517813
 0.448424   0.448584  0.449056  0.449811     0.215458   0.460101  0.517813
 0.262579   0.292872  0.329462  0.354257     0.252407   0.460145  0.517813
 0.331959   0.344974  0.363519  0.375021     0.279576   0.460216  0.517813
 0.378269   0.380075  0.378472  0.372819  …  0.299584   0.460314  0.517813
 0.411158   0.402641  0.380137  0.361152     0.314874   0.460436  0.517813
 0.434784   0.416654  0.376212  0.354118     0.326916   0.460581  0.517812
 0.451608   0.425554  0.373211  0.352812     0.336619   0.460746  0.517812
 0.463439   0.431679  0.373168  0.35199      0.344575   0.460929  0.517812
 ⋮                                        ⋱                       ⋮
 0.217897   0.221593  0.230885  0.24248      0.233939   0.460062  0.517677
 0.188655   0.194593  0.208452  0.224291     0.21602    0.460046  0.517676
 0.150391   0.160809  0.181943  0.202992     0.193688   0.460034  0.517676
 0.0951078  0.116534  0.149307  0.17612      0.164592   0.460025  0.517676
 0.470224   0.470224  0.470226  0.47023   …  0.126188   0.460019  0.517676
 0.535261   0.535261  0.535259  0.535257     0.0967888  0.460017  0.517675
 0.484314   0.484303  0.484268  0.484211     0.125527   0.460019  0.517675
 0.13128    0.159715  0.197711  0.226742     0.163325   0.460023  0.517675
 0.197604   0.212011  0.238667  0.263575     0.191816   0.460032  0.517675</code></pre><h3 id="Plot-the-FTLEs-on-Top-of-Each-Other"><a class="docs-heading-anchor" href="#Plot-the-FTLEs-on-Top-of-Each-Other">Plot the FTLEs on Top of Each Other</a><a id="Plot-the-FTLEs-on-Top-of-Each-Other-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-FTLEs-on-Top-of-Each-Other" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot(fFTLE, ftle_cache,fill=false, title=&quot;FTLE, t = $t0&quot;, xlabel=&quot;x&quot;, ylabel=&quot;y&quot;, colorbar=false, levels = 30, c=:inferno)
plot!(bFTLE, ftle_cache, fill=false, colorbar=false, levels = 30, c=:viridis)</code></pre><img src="dc476b83.svg" alt="Example block output"/><p>The code here creates a gif</p><pre><code class="nohighlight hljs">fFTLE = similar(x0)
bFTLE = similar(x0)

@gif for t0 in 0.0:1.0:10.0
    print(t0)

    xf, yf = displacement_field(u,v,x0,y0,(t0,t0+T))
    xb, yb = displacement_field(u,v,x0,y0,(t0,t0-T))

    compute_FTLE!(fFTLE,xf,yf,dx,dx,T)
    compute_FTLE!(bFTLE,xb,yb,dx,dx,T)

    plot(fFTLE, ftle_cache,fill=false, title=&quot;FTLE, t = $t0&quot;, xlabel=&quot;x&quot;, ylabel=&quot;y&quot;, colorbar=false, levels = 30, c=:inferno)
    plot!(bFTLE, ftle_cache, fill=false, colorbar=false, levels = 30, c=:viridis)

end every 1 fps = 2</code></pre><h2 id="Example-2-Issues-with-the-Sliding-Window-Approach"><a class="docs-heading-anchor" href="#Example-2-Issues-with-the-Sliding-Window-Approach">Example 2 - Issues with the Sliding-Window Approach</a><a id="Example-2-Issues-with-the-Sliding-Window-Approach-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2-Issues-with-the-Sliding-Window-Approach" title="Permalink"></a></h2><p>The sliding-window approach attempts to detect Langragian coherent structures (LCS) by computing the FTLE fields over windows of the form [t0, t0 + T] with varying t0 values. However, this approach does not obey Lagrangian invariance because the LCS&#39;s at different t0 values do not evolve into each other (Haller 2015).</p><p>This example illustrates the point above.</p><h3 id="First,-generate-initial-conditions."><a class="docs-heading-anchor" href="#First,-generate-initial-conditions.">First, generate initial conditions.</a><a id="First,-generate-initial-conditions.-1"></a><a class="docs-heading-anchor-permalink" href="#First,-generate-initial-conditions." title="Permalink"></a></h3><pre><code class="language-julia hljs">X_MIN, X_MAX = -6.0, 50.0
Y_MIN, Y_MAX = -2, 2
dx = 0.08

ftlegrid = PhysicalGrid((X_MIN,X_MAX),(Y_MIN,Y_MAX),dx);
ftle_cache = SurfaceScalarCache(ftlegrid)
x0, y0 = x_grid(ftle_cache), y_grid(ftle_cache)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(CartesianGrids.Primal nodes in a (nx = 702, ny = 52) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 701, ny = 51), CartesianGrids.Primal nodes in a (nx = 702, ny = 52) cell grid of type Float64 data
  Number of CartesianGrids.Primal nodes: (nx = 701, ny = 51))</code></pre><h3 id="Define-the-Vector-Field"><a class="docs-heading-anchor" href="#Define-the-Vector-Field">Define the Vector Field</a><a id="Define-the-Vector-Field-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-Vector-Field" title="Permalink"></a></h3><pre><code class="language-julia hljs">u2(x,y) = 1 + tanh.(x).^2
v2(x,y) = -2 * tanh.(x) ./ cosh.(x).^2 .* y</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">v2 (generic function with 1 method)</code></pre><h3 id="Solve-the-IVP-and-Compute-FTLEs-with-the-Sliding-Window-Approach"><a class="docs-heading-anchor" href="#Solve-the-IVP-and-Compute-FTLEs-with-the-Sliding-Window-Approach">Solve the IVP and Compute FTLEs with the Sliding-Window Approach</a><a id="Solve-the-IVP-and-Compute-FTLEs-with-the-Sliding-Window-Approach-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-the-IVP-and-Compute-FTLEs-with-the-Sliding-Window-Approach" title="Permalink"></a></h3><p>As shown in the figure,although the flow is unsteady, the actual LCS is a material line that moves with the flow to the right. Nevertheless, as shown in the gif below, when t0 varies from 0.0 to 10.0, the forward FTLE fields reveals a repelling LCS fixed on the y-axis.</p><p><img src="https://github.com/qiyuanbillwu/ILMPostProcessing.jl/raw/master/Lagrangian_Invariance.png" alt="Lack of Lagrangian Invariance"/></p><pre><code class="language-julia hljs">fFTLE = similar(x0)
T = 5

@gif for t0 in 0.0:0.5:10.0
    print(t0)

    xf, yf = displacement_field(u2,v2,x0,y0,(t0,t0+T))
    compute_FTLE!(fFTLE,xf,yf,dx,dx,T)

    plot(fFTLE, ftle_cache,fill=false, title=&quot;FTLE, t = $t0&quot;, xlabel=&quot;x&quot;, ylabel=&quot;y&quot;, colorbar=false, levels = 30, c=:inferno)

end every 1 fps = 2</code></pre><img src="4eebd385.gif" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dmdtest/">« Dynamic mode decomposition (DMD)</a><a class="docs-footer-nextpage" href="../ftle/">Finite-Time Lyapunov Exponent (FTLE) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Wednesday 18 June 2025 02:33">Wednesday 18 June 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
